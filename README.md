corroborator
============

Case management with data validation, corroboration, omission and duplication checking

## Installation

virtualenv should be used for package management
To install virtualenv
```
[sudo] apt-get install virtualenv
```

Other packages are required for modules and other build dependencies:
```
[sudo] apt-get install libmysqlclient-dev python-dev mysql-client libxslt-dev libgeos-c1
```

#### Install local python environment
From the root folder run:

```
virtualenv --python=python2.7 env --no-site-packages
```

#### Install required packages
```
env/bin/pip install -r requirements.txt
```

You may encounter an error related to the 'distribute' module. In this case, run

```
env/bin/easy_install -U distribute
```

#### Set up system celeryd install
On Debian, the configuration file for celeryd exists in /etc/default/celeryd

#### pull in git submodules
```
git submodule init
git submodule update --recursive
```

#### Create and configure database
In mysql, create a database and user for the app:
```
CREATE DATABASE corroborator_staging;
CREATE USER 'django'@'localhost' identified by 'password';
GRANT ALL ON corroborator_staging.* to 'django'@'localhost';
```
Add this username and password combination to DATABASE in ```corroborator/settings/staging.py```.

#### Initial db sync
If you have no database set up, run
```
env/bin/python2.7 managestaging.py syncdb
```
Then run the migration in the next setting.

#### Existing DB migration
```
env/bin/python managestaging.py migrate
```

Solr Usage
==========

Solr needs a few packages installed before use:
```
[sudo] apt-get install supervisor openjdk-6-jdk
```

Changes to model schema where new fields are added or removed from Bulletin, Incident or Actor
models will require an update to the solr schema. To do this the schema.xml file must be updated.
Haystack will generate a new schema.xml file with the command

```
env/bin/python manage.py build_solr_schema > schema.xml --settings=[local settings]
```
from the root dir of the project

you must then copy this file to the conf folder of your solr instance and add this line under the fields section
```
<field name="_version_" type="long" indexed="true" stored="true"/>
```

The schema can then be re-generated by running
```
env/bin/python manage.py rebuild_index --settings=[local settings]
```

